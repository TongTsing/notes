这样一个方案： 蓝色主库在停止前，绿色从库设置为主库且设置为可读可写，并且把蓝色主库设置为只读，这样新的数据写操作都在绿色主库上执行，之后再把蓝主变为从库

你提出的方案基本上是可行的，它确保了在切换过程中的平滑过渡，并且在保证数据一致性的前提下实现了服务的不间断。下面是你的方案的步骤：

1. **将绿色从库设置为主库**：在蓝色主库停止之前，将绿色从库设置为主库并允许读写操作。这样，新的写操作将在绿色主库上执行。
2. **将蓝色主库设置为只读**：为了防止在切换过程中发生数据写入冲突，将蓝色主库设置为只读模式，确保只有读操作可以执行。
3. **进行流量切换**：在绿色主库设置为可读可写后，将应用程序的流量逐渐切换到绿色主库，保证业务不受影响。
4. **将蓝色主库设置为从库**：当绿色主库稳定运行并且流量已经完全切换后，将蓝色主库设置为从库，保证数据同步和冗余备份。
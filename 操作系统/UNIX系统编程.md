# UNIX系统编程

### 一、环境变量

环境列表
每个进程都有一个环境列表，是进程的用户空间内存中维护的一组环境变量。
这个列表的每个元素都包含一个名字和相应的值。当通过 fork()创建新进程时，
继承父进程的环境。因此环境提供了一种父进程向子进程传递信息的机制。当进
程使用 exec()替换原有程序时，新的程序要么继承老程序的环境，要么使用 exec()
调用指定的新环境参数。

环境变量在多数 shell 中都是通过 export 命令来创建（C shell 使用 setenv 命
令），例子如下：

```
$ export MYVAR='Hello world'
```

C 程序可以使用一个 external 变量（char **environ）来访问环境，还有许多
库函数允许进程获得和修改环境中的值。
环境变量有许多用途。例如 shell 定义和使用了大量变量，可以被 shell 执行
的脚本和程序访问。包括变量 HOME（指定了用户登录目录的路径）、变量 PATH
（指定了一组目录，shell 执行用户输入的命令时会在里面查找相应的程序）。

### 二、资源限制

每个进程都要消耗资源，例如打开的文件、内存、CPU 时间。进程可以使用
setrlimit()系统调用设置自己消耗各种资源的上限。每个资源限制都有两个关联的
值：软限制，限制了进程可以消耗的资源数量；硬限制，是软限制可以调整的上
限。非特权进程可以把软限制设为 0 到相应的硬限制，但是只能降低硬限制。
当新进程创建时，会继承父进程的资源限制设置。
shell 的资源限制可以使用 ulimit 命令进行调整（C shell 使用 limit）。这些限
制值会被 shell 执行命令创建的子进程继承。

### 三、内存映射

使用 mmap()系统调用可以在调用进程的虚拟地址空间中创建新的内存映射

- 文件映射：文件映射把文件区域映射到调用进程的***虚拟内存***中。一旦映射完成，就可以通过相应内存区域来访问文件内容。当需要时会自动从文件装载到内存页面中。
- 匿名映射：匿名映射则没有相应的文件。相反所有映射的页面都初始化为 0；

### 四、进程/线程

#### 4.1 线程

- 每个线程都执行同一个程序代码文件，并且共享相同的数据区域和堆。但是每个线程拥有自己的堆栈，里面存放本地变量和函数调用链接信息；
- 使用的线程的主要优点是多个线程间共享数据非常容易（通过全局变量）；因为全局变量是映射到虚存的.bss节中而不是栈中；

### 五、文件操作

- 通过stat函数查看文件的struct stat 结构体的st_mode权限的时候，可以让st_mode和S_IFMT逻辑与；来获得结果；